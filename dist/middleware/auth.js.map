{"version":3,"file":"auth.js","names":["protect","asyncHandler","req","res","next","token","headers","authorization","startsWith","split","replace","makeResponse","status","message","decodedUser","decodeJwtToken","data","getOneUser","_id","user","userProtect","params","id","is_admin","adminProtect"],"sources":["../../src/middleware/auth.js"],"sourcesContent":["import { getOneUser } from '../repository/user'\r\nimport { decodeJwtToken } from '../utils/jwt'\r\nimport { makeResponse } from '../utils/response'\r\nimport asyncHandler from './async'\r\n\r\nexport const protect = asyncHandler(async (req, res, next) => {\r\n    const token = req.headers.authorization ? (req.headers.authorization.startsWith('Bearer') ? req.headers.authorization.split(' ')[1]?.replace('null', '')?.replace('undefined', '') : null) : null\r\n    if (!token) return makeResponse({ res, status: 403, message: 'Unauthorized' })\r\n    const decodedUser = decodeJwtToken(token).data\r\n    const user = decodedUser ? await getOneUser({ _id: decodedUser._id }, false) : null\r\n    if (!user) return makeResponse({ res, status: 403, message: 'Unauthorized' })\r\n    req.user = user\r\n    next()\r\n})\r\n\r\nexport const userProtect = asyncHandler(async (req, res, next) => {\r\n    if (req.user._id != req.params.id && !req.user.is_admin) return makeResponse({ res, status: 401, message: 'Unauthorized' })\r\n    next()\r\n})\r\n\r\nexport const adminProtect = asyncHandler(async (req, res, next) => {\r\n    if (!req.user.is_admin) return makeResponse({ res, status: 401, message: 'Unauthorized' })\r\n    next()\r\n})\r\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAAkC;AAAA,+CAFlC;AAAA;AAAA;AAIO,IAAMA,OAAO,GAAG,IAAAC,iBAAY;EAAA,sEAAC,iBAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI;IAAA;IAAA;IAAA;MAAA;QAAA;UAC/CC,KAAK,GAAGH,GAAG,CAACI,OAAO,CAACC,aAAa,GAAIL,GAAG,CAACI,OAAO,CAACC,aAAa,CAACC,UAAU,CAAC,QAAQ,CAAC,4BAAGN,GAAG,CAACI,OAAO,CAACC,aAAa,CAACE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,oFAAvC,sBAAyCC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,2DAA5D,uBAA8DA,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,GAAG,IAAI,GAAI,IAAI;UAAA,IAC5LL,KAAK;YAAA;YAAA;UAAA;UAAA,iCAAS,IAAAM,sBAAY,EAAC;YAAER,GAAG,EAAHA,GAAG;YAAES,MAAM,EAAE,GAAG;YAAEC,OAAO,EAAE;UAAe,CAAC,CAAC;QAAA;UACxEC,WAAW,GAAG,IAAAC,mBAAc,EAACV,KAAK,CAAC,CAACW,IAAI;UAAA,KACjCF,WAAW;YAAA;YAAA;UAAA;UAAA;UAAA,OAAS,IAAAG,gBAAU,EAAC;YAAEC,GAAG,EAAEJ,WAAW,CAACI;UAAI,CAAC,EAAE,KAAK,CAAC;QAAA;UAAA;UAAA;UAAA;QAAA;UAAA,cAAG,IAAI;QAAA;UAA7EC,IAAI;UAAA,IACLA,IAAI;YAAA;YAAA;UAAA;UAAA,iCAAS,IAAAR,sBAAY,EAAC;YAAER,GAAG,EAAHA,GAAG;YAAES,MAAM,EAAE,GAAG;YAAEC,OAAO,EAAE;UAAe,CAAC,CAAC;QAAA;UAC7EX,GAAG,CAACiB,IAAI,GAAGA,IAAI;UACff,IAAI,EAAE;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACT;EAAA;IAAA;EAAA;AAAA,IAAC;AAAA;AAEK,IAAMgB,WAAW,GAAG,IAAAnB,iBAAY;EAAA,uEAAC,kBAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI;IAAA;MAAA;QAAA;UAAA,MACrDF,GAAG,CAACiB,IAAI,CAACD,GAAG,IAAIhB,GAAG,CAACmB,MAAM,CAACC,EAAE,IAAI,CAACpB,GAAG,CAACiB,IAAI,CAACI,QAAQ;YAAA;YAAA;UAAA;UAAA,kCAAS,IAAAZ,sBAAY,EAAC;YAAER,GAAG,EAAHA,GAAG;YAAES,MAAM,EAAE,GAAG;YAAEC,OAAO,EAAE;UAAe,CAAC,CAAC;QAAA;UAC3HT,IAAI,EAAE;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACT;EAAA;IAAA;EAAA;AAAA,IAAC;AAAA;AAEK,IAAMoB,YAAY,GAAG,IAAAvB,iBAAY;EAAA,uEAAC,kBAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI;IAAA;MAAA;QAAA;UAAA,IACrDF,GAAG,CAACiB,IAAI,CAACI,QAAQ;YAAA;YAAA;UAAA;UAAA,kCAAS,IAAAZ,sBAAY,EAAC;YAAER,GAAG,EAAHA,GAAG;YAAES,MAAM,EAAE,GAAG;YAAEC,OAAO,EAAE;UAAe,CAAC,CAAC;QAAA;UAC1FT,IAAI,EAAE;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACT;EAAA;IAAA;EAAA;AAAA,IAAC;AAAA"}