{"version":3,"file":"user.js","names":["createUser","user","User","save","userMade","toObject","password","getAllUsers","sort","filter","page","limit","options","collation","locale","Object","keys","length","aggregateQuery","aggregate","$match","$unset","aggregatePaginate","err","logger","error","message","getOneUser","filters","returnPassword","findOne","lean","findOneAndUpdateUser","data","findOneAndUpdate","getAllUserIds","find","select","users","map","_id","findOneAndRemoveUser","findOneAndRemove"],"sources":["../../src/repository/user.js"],"sourcesContent":["import User from '../models/user'\r\nimport logger from '../utils/logger'\r\n\r\nexport const createUser = async (user) => {\r\n    const userMade = (await new User(user).save()).toObject()\r\n    delete userMade.password\r\n    return userMade\r\n}\r\n\r\nexport const getAllUsers = async ({ sort = {}, filter = {}, page, limit = 10 }) => {\r\n    const options = {\r\n        page,\r\n        limit,\r\n        collation: {\r\n            locale: 'en'\r\n        }\r\n    }\r\n\r\n    if (Object.keys(sort).length > 0) options.sort = sort\r\n\r\n    const aggregateQuery = () =>\r\n        User.aggregate([\r\n            {\r\n                $match: filter\r\n            },\r\n            { $unset: ['password'] }\r\n        ])\r\n\r\n    return await (page ? User.aggregatePaginate(aggregateQuery(), options) : aggregateQuery()).catch((err) => {\r\n        logger.error(`An error occurred when retrieving users - err: ${err.message}`)\r\n        throw err\r\n    })\r\n}\r\n\r\nexport const getOneUser = async (filters, returnPassword = false) => {\r\n    const user = await User.findOne(filters).lean()\r\n    if (!user) return null\r\n\r\n    if (!returnPassword) delete user.password\r\n    return user\r\n}\r\n\r\nexport const findOneAndUpdateUser = async (filters, data) => {\r\n    const user = await User.findOneAndUpdate(filters, data, { new: true }).lean()\r\n    if (!user) return null\r\n\r\n    delete user.password\r\n    return user\r\n}\r\n\r\nexport const getAllUserIds = async (filters = {}) => {\r\n    const users = await User.find(filters).select('_id').lean()\r\n    return users.map((user) => user._id)\r\n}\r\n\r\n\r\nexport const findOneAndRemoveUser = async (filters) => {\r\n    return await User.findOneAndRemove(filters)\r\n}\r\n"],"mappings":"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"}